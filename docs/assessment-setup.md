# アセスメントシート機能のセットアップガイド

## 概要

アセスメントシート機能は、テキストデータから自動的にアセスメント情報を抽出する機能です。
**個人情報保護のため、氏名・住所・連絡先などの個人を特定できる情報は記録しません。**
OpenAI GPT-4oを使用してAI解析を行います。

## カルテの構成

### 個人情報保護について

**❌ 記録しない情報：**
- 氏名（本人・家族）
- 生年月日、年齢
- 住所
- 電話番号、携帯番号
- その他、個人を特定できる情報

**✅ 記録する情報：**
- 記入日、相談経路、担当者名
- 性別、続柄、同居状況
- ひきこもりの状況、生活状況
- 支援ニーズなど

## 前提条件

- OpenAI APIアカウント
- OpenAI APIキー

## セットアップ手順

### 1. OpenAI APIキーの取得

1. [OpenAI Platform](https://platform.openai.com/) にアクセス
2. アカウントにログイン（アカウントがない場合は新規登録）
3. 右上のメニューから「API keys」を選択
4. 「Create new secret key」をクリック
5. 生成されたAPIキーをコピー（**この時点でのみ表示されます**）

### 2. 環境変数の設定

プロジェクトルートに `.env.local` ファイルを作成（または既存ファイルに追記）：

```bash
# .env.local

# OpenAI API設定
OPENAI_API_KEY=sk-proj-xxxxxxxxxxxxxxxxxxxxxxxxxx

# 既存の環境変数
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=your_clerk_key
CLERK_SECRET_KEY=your_clerk_secret
```

**重要：**
- `.env.local` ファイルは `.gitignore` に含まれており、Gitにコミットされません
- APIキーは絶対に公開しないでください

### 3. 開発サーバーの再起動

環境変数を読み込むため、開発サーバーを再起動します：

```bash
# 開発サーバーを停止（Ctrl+C）
# 再度起動
pnpm dev
```

### 4. 動作確認

1. ブラウザで http://localhost:3000 にアクセス
2. ダッシュボードにログイン
3. サイドバーから「アセスメントシート」を選択
4. 「サンプルデータを使用」ボタンをクリック
5. 「アセスメント情報を抽出」ボタンをクリック
6. AI解析が実行され、結果が表示されれば成功

## 使用方法

### 基本的な使い方

1. **テキスト入力**
   - 会話記録やメモを直接テキストエリアに入力
   - または「ファイルをアップロード」ボタンで.txt/.mdファイルを読み込み
   - **※個人を特定できる情報（氏名、住所、電話番号など）は入力しないでください**

2. **抽出実行**
   - 「アセスメント情報を抽出」ボタンをクリック
   - AI解析が実行されます（5-10秒程度）

3. **結果確認**
   - 自動的に「分析結果」タブに切り替わります
   - 9つのカテゴリに分類された情報を確認

### サンプルデータでテスト

APIキーを使用せずにテストする場合：

1. 「サンプルデータを使用」ボタンをクリック
2. モックデータが即座に表示されます
3. UI/UXの確認に最適

### 推奨されるテキスト形式

抽出精度を高めるため、以下の形式を推奨します：

```
【基本情報】
記入日：2025年11月3日
相談経路：保健所からの紹介
性別：男性

【ひきこもりの状況】
開始時期：2022年3月（約3年6ヶ月）
きっかけ：就職活動の失敗、対人関係のストレス
現在の状態：ほぼ毎日自室で過ごし、月1-2回深夜のコンビニに外出する程度

【生活状況】
睡眠：完全な昼夜逆転（起床14時、就寝5時）
食事：1日2回、家族と別に自室で
外出：月1-2回、深夜のコンビニのみ

【生育歴】
幼少期：おとなしく、人見知りが激しい
中学時：約3ヶ月不登校（いじめが原因）
学歴：大学卒業後、就職活動で内定が取れず

【本人の意向】
「このままではいけないとは思っているが、何をすればいいかわからない」
「まずは生活リズムを整えたい」

...（続く）
```

**重要：** 氏名、生年月日、住所、電話番号などの個人情報は入力しないでください。

## トラブルシューティング

### エラー: OpenAI APIキーが設定されていません

**原因:**
- 環境変数 `OPENAI_API_KEY` が設定されていない
- `.env.local` ファイルが読み込まれていない

**解決方法:**
1. `.env.local` ファイルを確認
2. `OPENAI_API_KEY=sk-proj-...` が正しく記載されているか確認
3. 開発サーバーを再起動

### エラー: APIリクエストが失敗しました

**原因:**
- APIキーが無効または期限切れ
- OpenAI APIの利用制限に達している
- ネットワーク接続の問題

**解決方法:**
1. [OpenAI Platform](https://platform.openai.com/) でAPIキーの状態を確認
2. 使用量と請求情報を確認
3. 新しいAPIキーを生成して再設定

### 抽出精度が低い場合

**改善方法:**
1. **テキスト量を増やす**
   - 最低でも100文字以上を推奨
   - より詳細な情報を提供する

2. **構造化されたテキストを使用**
   - 箇条書きや見出しを活用
   - 項目名を明示的に記載（例：「氏名：」「年齢：」）

3. **重要な情報を優先**
   - ひきこもりの経過（開始時期、きっかけ、現在の状況）
   - 生活状況（睡眠、食事、外出状況）
   - 支援ニーズ（本人・家族の希望）
   - 性別、相談経路など（個人を特定しない情報）

## API使用料金について

### 料金体系（2024年11月時点）

- **モデル**: GPT-4o
- **入力**: $5.00 / 1M tokens
- **出力**: $15.00 / 1M tokens

### 概算コスト

1回のアセスメント抽出あたり：
- 入力トークン: 約1,000-2,000トークン（テキスト量による）
- 出力トークン: 約500-1,000トークン
- **推定コスト**: 約$0.01-0.03（約1.5-4.5円）

**注意：**
- 使用量はOpenAI Platformで確認できます
- 無料枠（$5クレジット）が提供される場合があります
- 予算制限を設定することを推奨

## セキュリティ注意事項

### 個人情報保護

1. **記録しない情報**
   - 氏名（本人・家族）
   - 生年月日、年齢
   - 住所
   - 電話番号、携帯番号
   - その他、個人を特定できる情報

2. **データ入力時の注意**
   - テキスト入力時に、個人を特定できる情報を除外してください
   - 必要に応じて匿名ID（例：ケースA、対象者Bなど）を使用してください

### APIキーの管理

1. **APIキーの管理**
   - `.env.local` ファイルは絶対にGitにコミットしない
   - APIキーを公開リポジトリに含めない
   - 定期的にAPIキーをローテーション

2. **データの取り扱い**
   - 個人情報を含むデータは匿名化処理を推奨
   - 本番環境では適切なアクセス制御を実装
   - データ保存時は暗号化を検討

3. **API使用制限**
   - レート制限に注意（OpenAI API制限に従う）
   - 大量のリクエストを避ける
   - エラーハンドリングとリトライロジックを実装

## 参考リンク

- [OpenAI API Documentation](https://platform.openai.com/docs)
- [OpenAI Pricing](https://openai.com/api/pricing/)
- [Next.js Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)

## サポート

問題が解決しない場合は、以下を確認してください：
1. 開発者コンソールのエラーメッセージ
2. サーバーログ（ターミナル出力）
3. OpenAI APIのステータスページ

---

**最終更新**: 2025年12月8日

